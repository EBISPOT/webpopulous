<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons.css" />
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>


<div>

    <div align="left">
    </div>

    <div align="left">
        <table>
            <tr>
                <td style="padding-right:3px;">
                    <input  size="45" class="serverSelect" type="text" placeholder="Enter Webulous server URL">
                </td>
                <td align="right">
                    <input id="getTemplateButton" type="button" value="Get" onclick="google.script.run.withFailureHandler(onFailure).withSuccessHandler(showTemplates).getTemplates($('.serverSelect').val());"/></td>
            </tr>
        </table>
        <i>e.g."http://54.148.43.5:8080/webulous"</i>
        <hr/>

        <div align="center">
            <select style="width:100%;" class="templateSelect">
                <option value="" disabled="disabled" selected="selected">Choose a template</option>
            </select>
        </div>

        <br/><br/>
        <p class="errorMessage" style="display:none; color:red;">Failed to connect to template server</p>

        <div align="right">
            <table>
                <tr>
                    <td align="left" style="padding-right:5px;">
                        <div class="loading" style="display:none">
                            <img style="height:30px;width:30px;" src="https://5079980847011989849-a-1802744773732722657-s-sites.googlegroups.com/site/scriptsexamples/ProgressSpinner.gif"/>
                        </div>
                    <td>
                    <td style="width:100px; padding-right:3px;">
                        <input class="selectTemplateButton" disabled="disabled" type="button" value="Open template" onclick="templateSelected()"/></td>
                    <td><input type="button" value="Cancel" onclick="google.script.host.close();" /></td>
                </tr>
            </table>


        </div>
    </div>
</div>

<script>

    function enableButton () {
        $('input.selectTemplateButton').removeAttr('disabled');;
    }

    function showTemplates(data) {
        if (data == null) {
            $('.errorMessage').text("Couldn't find any templates at this server");
            $('.errorMessage').show();
        }
        else if (data.length == 0) {
            $('.errorMessage').text("No templates defined on this server");
            $('.errorMessage').show();
        }
        else {
            $('select.templateSelect').html('');
            for (var i = 0; i < data.length ; i++) {
                $('select.templateSelect').append("<option value='" + data[i].id + "'>" + data[i].description + "</option>");
            }
            enableButton();
        }
    }

    function templateSelected () {
        $('div.loading').show();
        google.script.run.withFailureHandler(onFailure).withSuccessHandler(onSuccess).setSource($('.serverSelect').val(), $('select.templateSelect').val());
    }


    function onFailure(error){
        $('.errorMessage').text(error);
        $('.errorMessage').show();
    }

    function onSuccess(){
        google.script.host.close();
    }




</script>